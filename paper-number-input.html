<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../paper-styles/color.html">
<link rel="import" href="../polymer/polymer.html">

<dom-module id="paper-number-input">
  <template>
    <style>
      :host {
        display: block;
        box-sizing: border-box;
      }
      #input {
        text-align: center;
        --paper-input-container-input: {
          -moz-appearance: textfield;
          appearance: textfield;
        };
        --paper-input-container-input-webkit-spinner: {
          -webkit-appearance: none;
          appearance: none;
          margin: 0;
        };
        @apply --paper-number-input-paper-input;
      }
      .spinner {
        margin: 0;
        min-width: auto;
        --paper-button-disabled: {
          background: transparent;
        };
        @apply --paper-number-input-spinner;
      }
      .spinner:hover {
        background: rgba(0, 0, 0, 0.1);
        @apply --paper-number-input-spinner-hover;
      }
    </style>

    <paper-input
        id="input"
        type="number"
        value="{{value}}"
        label="[[label]]"
        no-label-float="[[noLabelFloat]]"
        always-float-label="[[alwaysFloatLabel]]"
        aria-labelledby$="[[_ariaLabelledBy]]"
        aria-describedby$="[[_ariaDescribedBy]]"
        disabled$="[[disabled]]"
        title$="[[title]]"
        invalid="{{invalid}}"
        validator="[[validator]]"
        required$="[[required]]"
        autofocus$="[[autofocus]]"
        min$="[[min]]"
        max$="[[max]]"
        step$="[[step]]"
        name$="[[name]]"
        placeholder$="[[placeholder]]"
        readonly$="[[readonly]]"
        tabindex$="[[tabIndex]]"
        error-message="{{errorMessage}}"
        required="{{required}}"
        auto-validate="[[autoValidate]]"
        on-focusout="_handleFocusout">

      <paper-button
          tabindex="-1"
          class="spinner"
          slot="prefix"
          prefix
          on-tap="stepDown"
          disabled="[[_computeStepDownButtonDisabled(value, min, disabled)]]">
        <iron-icon icon="[[stepDownIcon]]"></iron-icon>
      </paper-button>

      <slot name="prefix" slot="prefix"></slot>
      <slot name="suffix" slot="suffix"></slot>

      <paper-button
          tabindex="-1"
          class="spinner"
          slot="suffix"
          suffix
          on-tap="stepUp"
          disabled="[[_computeStepUpButtonDisabled(value, max, disabled)]]">
        <iron-icon icon="[[stepUpIcon]]"></iron-icon>
      </paper-button>

    </paper-input>

  </template>
  <script>

    /**
     * 
     * @customElement
     * @polymer
     * @demo demo Sandbox snippet
     */
    class PaperNumberInput extends Polymer.Element {

      static get is() {
        return 'paper-number-input';
      }

      static get properties() {
        return {
          /**
          * The tabindex for this input.
          */
          tabIndex: Number,
          /**
          * The label for this input.
          */
          label: String,
          /**
          * The number that represents the current value.
          */
          value: {
            type: Number,
            notify: true
          },
          /**
          * Set to true to disable this input.
          */
          disabled: {
            type: Boolean,
            value: false
          },
          /**
          * Returns true if the value is invalid.
          *
          * If `autoValidate` is true, the `invalid` attribute is managed automatically,
          * which can clobber attempts to manage it manually.
          */
          invalid: {
            type: Boolean,
            value: false,
            notify: true
          },
          /**
          * Set to true to mark the input as required.
          */
          required: {
            type: Boolean,
            value: false
          },
          /**
          * The error message to display when the input is invalid.
          */
          errorMessage: String,
          /**
          * Set to true to disable the floating label.
          */
          noLabelFloat: Boolean,
          /**
          * Set to true to always float the label.
          */
          alwaysFloatLabel: Boolean,
          /**
          * Set to true to auto-validate the input value.
          */
          autoValidate: {
            type: Boolean,
            value: false
          },
          /**
          * Name of the validator to use.
          */
          validator: String,
          /**
          */
          autofocus: Boolean,
          /**
          * The number that indicates the minimum value.
          */
          min: Number,
          /**
          * The number that indicates the maximum value.
          */
          max: Number,
          /**
          * The number that indicates the value increment granularity for
          * stepUp and stepDown actions.
          */
          step: Number,
          /**
          * The name of this element.
          */
          name: String,
          /**
          * A placeholder string in addition to the label. If this is set, the label will always float.
          */
          placeholder: String,
          /**
          * If true, the value can't change due to user input.
          */
          readonly: {
            type: Boolean,
            value: false
          },
          /**
          *
          */
          _ariaDescribedBy: String,
          /**
          *
          */
          _ariaLabelledBy: String,
          /**
          * Default fallback when value is not a number.
          */
          fallbackValue: {
            type: Number,
            value: null
          },
          /**
          * The icon key for the step down button. You will need to import an
          * icon set for the icon to appear.
          */
          stepDownIcon: {
            type: String,
            value: 'remove'
          },
          /**
          * The icon key for the step up button. You will need to import an
          * icon set for the icon to appear.
          */
          stepUpIcon: {
            type: String,
            value: 'add'
          }
        };
      }

      get _input() {
        return this.$.input._focusableElement;
      }

      setFallbackValue() {
        if (this.fallbackValue === undefined) return;
        this.value = this.fallbackValue;
      }

      /**
       *
       */
      stepUp() {
        this._input.stepUp();
        this.value = this._input.value;
      }

      /**
       *
       */
      stepDown() {
        this._input.stepDown();
        this.value = this._input.value;
      }

      _computeStepDownButtonDisabled(value, min, disabled) {
        return disabled || parseFloat(value) <= parseFloat(min);
      }

      _computeStepUpButtonDisabled(value, max, disabled) {
        return disabled || parseFloat(value) >= parseFloat(max);
      }

      _handleFocusout() {
        if (!this._input.checkValidity()) {
          this.setFallbackValue();
        }
      }

    }

    customElements.define(PaperNumberInput.is, PaperNumberInput);

  </script>
</dom-module>
